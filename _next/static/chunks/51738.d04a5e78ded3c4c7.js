"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[51738],{51738:function(e,t,a){a.r(t),a.d(t,{connectSmartWallet:function(){return eS},disconnectSmartWallet:function(){return ej},isSmartWallet:function(){return eB}});var r=a(85946),n=a(50676),i=a(95810),s=a(57621),o=a(26182);let c=[{type:"address",name:"owner"},{type:"address",name:"spender"}],d=[{type:"uint256"}];async function l(e){return(0,o.readContract)({contract:e.contract,method:["0xdd62ed3e",c,d],params:[e.owner,e.spender]})}var u=a(98445),p=a(47537),m=a(35188),y=a(4159),f=a(90766),v=a(11223),h=a(26485),w=a(16327),g=a(57412),G=a(26087),b=a(49321),A=a(11187),L=a(91734),x=a(97123);let O=x.r;var P=a(39135),D=a(66238),C=a(78398),I=a(80522);let T="/docs/contract/decodeEventLog";var V=a(38766),U=a(36117);class E extends U.G{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}var M=a(45444),$=a(15102),N=a(58034);let k="/docs/contract/encodeEventTopics";function B({param:e,value:t}){if("string"===e.type||"bytes"===e.type)return(0,L.w)((0,A.O0)(t));if("tuple"===e.type||e.type.match(/^(.*)\[(\d+)?\]$/))throw new E(e.type);return(0,M.E)([e],[t])}function _(e){let t;let{signature:a}=e;return{abiEvent:t=a&&"object"==typeof a&&"type"in a&&"event"===a.type?a:(0,V.s)(a),hash:(0,x.r)(t),topics:function(e){let{abi:t,eventName:a,args:r}=e,n=t[0];if(a){let e=function(e){let t;let{abi:a,args:r=[],name:n}=e,i=(0,$.v)(n,{strict:!1}),s=a.filter(e=>i?"function"===e.type?(0,N.C)(e)===n:"event"===e.type&&O(e)===n:"name"in e&&e.name===n);if(0!==s.length){if(1===s.length)return s[0];for(let e of s)if("inputs"in e){if(!r||0===r.length){if(!e.inputs||0===e.inputs.length)return e;continue}if(e.inputs&&0!==e.inputs.length&&e.inputs.length===r.length&&r.every((t,a)=>{let r="inputs"in e&&e.inputs[a];return!!r&&function e(t,a){let r=typeof t,n=a.type;switch(n){case"address":return(0,b.U)(t,{strict:!1});case"bool":return"boolean"===r;case"function":case"string":return"string"===r;default:if("tuple"===n&&"components"in a)return Object.values(a.components).every((a,r)=>e(Object.values(t)[r],a));if(/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(n))return"number"===r||"bigint"===r;if(/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(n))return"string"===r||t instanceof Uint8Array;if(/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(n))return Array.isArray(t)&&t.every(t=>e(t,{...a,type:n.replace(/(\[[0-9]{0,}\])$/,"")}));return!1}}(t,r)})){if(t&&"inputs"in t&&t.inputs){let a=function e(t,a,r){for(let n in t){let i=t[n],s=a[n];if("tuple"===i.type&&"tuple"===s.type&&"components"in i&&"components"in s)return e(i.components,s.components,r[n]);let o=[i.type,s.type];if(o.includes("address")&&o.includes("bytes20")||(o.includes("address")&&o.includes("string")||o.includes("address")&&o.includes("bytes"))&&(0,b.U)(r[n],{strict:!1}))return o}}(e.inputs,t.inputs,r);if(a)throw new g.S4({abiItem:e,type:a[0]},{abiItem:t,type:a[1]})}t=e}}return t||s[0]}}({abi:t,name:a});if(!e)throw new g.mv(a,{docsPath:k});n=e}if("event"!==n.type)throw new g.mv(void 0,{docsPath:k});let i=O((0,I.t)(n)),s=[];if(r&&"inputs"in n){let e=n.inputs?.filter(e=>"indexed"in e&&e.indexed),t=Array.isArray(r)?r:Object.values(r).length>0?e?.map(e=>r[e.name])??[]:[];t.length>0&&(s=e?.map((e,a)=>Array.isArray(t[a])?t[a].map((r,n)=>B({param:e,value:t[a][n]})):t[a]?B({param:e,value:t[a]}):null)??[])}return[i,...s]}({abi:[t],args:e.filters})}}var H=a(75403),S=a(99910),j=a(75100),z=a(49329),F=a(52749);let R=()=>{let e=BigInt(Math.floor(4294967296*Math.random())),t=BigInt(Math.floor(4294967296*Math.random())),a=BigInt(Math.floor(4294967296*Math.random())),r=BigInt(Math.floor(4294967296*Math.random())),n=BigInt(Math.floor(4294967296*Math.random())),i=BigInt(Math.floor(4294967296*Math.random()));return e<<BigInt(160)|t<<BigInt(128)|a<<BigInt(96)|r<<BigInt(64)|n<<BigInt(32)|i};function q(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,null==t||(0,F.v)(t)?t:(0,H.NC)(t)]))}async function W(e){return ee({...e,operation:"eth_sendUserOperation",params:[q(e.userOp),e.options.entrypointAddress??z.Ex]})}async function K(e){let t=await ee({...e,operation:"eth_estimateUserOperationGas",params:[q(e.userOp),e.options.entrypointAddress??z.Ex]});return{preVerificationGas:(0,H.y_)(t.preVerificationGas),verificationGas:void 0!==t.verificationGas?(0,H.y_)(t.verificationGas):void 0,verificationGasLimit:(0,H.y_)(t.verificationGasLimit),callGasLimit:(0,H.y_)(t.callGasLimit)+z.X_,paymasterVerificationGasLimit:void 0!==t.paymasterVerificationGasLimit?(0,H.y_)(t.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:void 0!==t.paymasterPostOpGasLimit?(0,H.y_)(t.paymasterPostOpGasLimit):void 0}}async function X(e){let t=await ee({...e,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:(0,H.y_)(t.maxPriorityFeePerGas),maxFeePerGas:(0,H.y_)(t.maxFeePerGas)}}async function J(e){let t=await Q(e);if(t){if(!1===t.success){let e=function(e){let{logs:t,events:a,strict:r}=e;return function(e){let{abi:t,args:a,logs:r,strict:n=!0}=e,i=(()=>{if(e.eventName)return Array.isArray(e.eventName)?e.eventName:[e.eventName]})();return r.map(e=>{try{let r=t.find(t=>"event"===t.type&&e.topics[0]===O(t));if(!r)return null;let s=function(e){let{abi:t,data:a,strict:r,topics:n}=e,i=r??!0,[s,...o]=n;if(!s)throw new g.FM({docsPath:T});let c=1===t.length?t[0]:t.find(e=>"event"===e.type&&s===O((0,I.t)(e)));if(!(c&&"name"in c)||"event"!==c.type)throw new g.lC(s,{docsPath:T});let{name:d,inputs:l}=c,u=l?.some(e=>!("name"in e&&e.name)),p=u?[]:{},m=l.filter(e=>"indexed"in e&&e.indexed);for(let e=0;e<m.length;e++){let t=m[e],a=o[e];if(!a)throw new g.Gy({abiItem:c,param:t});p[u?e:t.name||e]=function({param:e,value:t}){return"string"===e.type||"bytes"===e.type||"tuple"===e.type||e.type.match(/^(.*)\[(\d+)?\]$/)?t:((0,C.r)([e],t)||[])[0]}({param:t,value:a})}let y=l.filter(e=>!("indexed"in e&&e.indexed));if(y.length>0){if(a&&"0x"!==a)try{let e=(0,C.r)(y,a);if(e){if(u)p=[...p,...e];else for(let t=0;t<y.length;t++)p[y[t].name]=e[t]}}catch(e){if(i){if(e instanceof g.xB||e instanceof D.lQ)throw new g.SM({abiItem:c,data:a,params:y,size:(0,P.d)(a)});throw e}}else if(i)throw new g.SM({abiItem:c,data:"0x",params:y,size:0})}return{eventName:d,args:Object.values(p).length>0?p:void 0}}({...e,abi:[r],strict:n});if(i&&!i.includes(s.eventName)||!function(e){let{args:t,inputs:a,matchArgs:r}=e;if(!r)return!0;if(!t)return!1;function n(e,t,a){try{if("address"===e.type)return function(e,t){if(!(0,b.U)(e,{strict:!1}))throw new G.b({address:e});if(!(0,b.U)(t,{strict:!1}))throw new G.b({address:t});return e.toLowerCase()===t.toLowerCase()}(t,a);if("string"===e.type||"bytes"===e.type)return(0,L.w)((0,A.O0)(t))===a;return t===a}catch{return!1}}return Array.isArray(t)&&Array.isArray(r)?r.every((e,r)=>{if(null==e)return!0;let i=a[r];return!!i&&(Array.isArray(e)?e:[e]).some(e=>n(i,e,t[r]))}):!("object"!=typeof t||Array.isArray(t)||"object"!=typeof r||Array.isArray(r))&&Object.entries(r).every(([e,r])=>{if(null==r)return!0;let i=a.find(t=>t.name===e);return!!i&&(Array.isArray(r)?r:[r]).some(a=>n(i,a,t[e]))})}({args:s.args,inputs:r.inputs,matchArgs:a}))return null;return{...s,...e}}catch(r){let t,a;if(r instanceof g.lC)return null;if(r instanceof g.SM||r instanceof g.Gy){if(n)return null;t=r.abiItem.name,a=r.abiItem.inputs?.some(e=>!("name"in e&&e.name))}return{...e,args:a?[]:{},eventName:t}}}).filter(Boolean)}({logs:t,abi:a.map(e=>e.abiEvent),strict:r})}({events:[function(e={}){return _({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:e})}(),function(e={}){return _({signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:e})}()],logs:t.logs}),a=e[0]?.args?.revertReason;if(!a)throw Error(`UserOp failed at txHash: ${t.receipt.transactionHash}`);let r=(0,w.p)({data:a});throw Error(`UserOp failed with reason: '${r.args.join(",")}' at txHash: ${t.receipt.transactionHash}`)}return t.receipt}}async function Q(e){let t=await ee({options:e,operation:"eth_getUserOperationReceipt",params:[e.userOpHash]});if(t)return function(e){let{receipt:t}=e,a={...t,transactionHash:t.transactionHash,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,contractAddress:t.contractAddress?t.contractAddress:null,cumulativeGasUsed:t.cumulativeGasUsed?BigInt(t.cumulativeGasUsed):null,effectiveGasPrice:t.effectiveGasPrice?BigInt(t.effectiveGasPrice):null,gasUsed:t.gasUsed?BigInt(t.gasUsed):null,logs:t.logs,to:t.to?t.to:null,transactionIndex:t.transactionIndex,status:t.status,type:t.type};return t.blobGasPrice&&(a.blobGasPrice=BigInt(t.blobGasPrice)),t.blobGasUsed&&(a.blobGasUsed=BigInt(t.blobGasUsed)),{...e,receipt:a,userOpHash:e.userOpHash,actualGasCost:BigInt(e.actualGasCost),actualGasUsed:BigInt(e.actualGasUsed),nonce:BigInt(e.nonce)}}(t)}async function Y(e){let t=await ee({options:e.options,operation:"zk_paymasterData",params:[e.transaction]});return{paymaster:t.paymaster,paymasterInput:t.paymasterInput}}async function Z(e){return{transactionHash:(await ee({options:e.options,operation:"zk_broadcastTransaction",params:[{...e.transaction,signedTransaction:e.signedTransaction}]})).transactionHash}}async function ee(e){let{options:t,operation:a,params:r}=e;z.eM&&console.debug(`>>> sending ${a} with payload:`,r);let n=t.bundlerUrl??(0,z.Rg)(t.chain),i=(0,S.NX)(t.client),s=await i(n,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,j.P)({jsonrpc:"2.0",id:1,method:a,params:r})}),o=await s.json();if(!s.ok||o.error){let e=o.error||s.statusText;"object"==typeof e&&(e=(0,j.P)(e));let t=o.code||"UNKNOWN";throw Error(`${a} error: ${e}
Status: ${s.status}
Code: ${t}`)}return z.eM&&console.debug(`<<< ${a} result:`,o),o.result}var et=a(21690);async function ea(e){let{factoryContract:t,predictAddressOverride:a,adminAddress:r,accountSalt:n,accountAddress:i}=e;if(a)return a(t);if(i)return i;if(!r)throw Error("Account address is required to predict the smart wallet address.");let s=n&&(0,F.v)(n)?n:(0,H.$G)(n??"");return(0,o.readContract)({contract:t,method:"function getAddress(address, bytes) returns (address)",params:[r,s]})}function er(e){let{adminAddress:t,factoryContract:a,createAccountOverride:r,accountSalt:n}=e;if(r)return r(a);let i=n&&(0,F.v)(n)?n:(0,H.$G)(n??"");return(0,et.A)({contract:a,method:"function createAccount(address, bytes) returns (address)",params:[t,i]})}function en(e){let{accountContract:t,transaction:a,executeOverride:r}=e;return r?r(t,a):(0,et.A)({contract:t,method:"function execute(address, uint256, bytes)",params:[a.to||"",a.value||0n,a.data||"0x"],gas:a.gas?a.gas+21000n:void 0})}var ei=a(57040);let es=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],eo=[{type:"uint256",name:"nonce"}];async function ec(e){return(0,o.readContract)({contract:e.contract,method:["0x35567e1a",es,eo],params:[e.sender,e.key]})}let ed=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],el=[{type:"bytes32"}];async function eu(e){return(0,o.readContract)({contract:e.contract,method:["0xa6193531",ed,el],params:[e.userOp]})}let ep=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],em=[{type:"bytes32"}];async function ey(e){return(0,o.readContract)({contract:e.contract,method:["0x22cdde4c",ep,em],params:[e.userOp]})}var ef=a(19500),ev=a(11692),eh=a(60689),ew=a(24951),eg=a(83159),eG=a(61769),eb=a(92106);let eA=e=>({sender:e.sender,nonce:e.nonce,initCode:e.factory?(0,ei.zo)([e.factory,e.factoryData||"0x"]):"0x",callData:e.callData,accountGasLimits:(0,ei.zo)([(0,eG.vk)((0,eb.NC)(e.verificationGasLimit),{size:16}),(0,eG.vk)((0,eb.NC)(e.callGasLimit),{size:16})]),preVerificationGas:e.preVerificationGas,gasFees:(0,ei.zo)([(0,eG.vk)((0,eb.NC)(e.maxPriorityFeePerGas),{size:16}),(0,eG.vk)((0,eb.NC)(e.maxFeePerGas),{size:16})]),paymasterAndData:e.paymaster?(0,ei.zo)([e.paymaster,(0,eG.vk)((0,eb.NC)(e.paymasterVerificationGasLimit||BigInt(0)),{size:16}),(0,eG.vk)((0,eb.NC)(e.paymasterPostOpGasLimit||BigInt(0)),{size:16}),e.paymasterData||"0x"]):"0x",signature:e.signature});async function eL(e){let{userOp:t,paymasterOverride:a,client:r,chain:n,entrypointAddress:i}=e;if(a)return a(t);let s=i??z.Ex,o=(0,z.Rg)(n),c=(0,S.NX)(r),d=await c(o,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,j.P)({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[q(t),s]})}),l=await d.json();if(!d.ok){let e=l.error||d.statusText,t=l.code||"UNKNOWN";throw Error(`Paymaster error: ${e}
Status: ${d.status}
Code: ${t}`)}if(z.eM&&console.debug("Paymaster result:",l),l.result)return"string"==typeof l.result?{paymasterAndData:l.result}:{paymasterAndData:l.result.paymasterAndData,verificationGasLimit:l.result.verificationGasLimit?(0,H.y_)(l.result.verificationGasLimit):void 0,preVerificationGas:l.result.preVerificationGas?(0,H.y_)(l.result.preVerificationGas):void 0,callGasLimit:l.result.callGasLimit?(0,H.y_)(l.result.callGasLimit):void 0,paymaster:l.result.paymaster,paymasterData:l.result.paymasterData,paymasterVerificationGasLimit:l.result.paymasterVerificationGasLimit?(0,H.y_)(l.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:l.result.paymasterPostOpGasLimit?(0,H.y_)(l.result.paymasterPostOpGasLimit):void 0};let u=l.error?.message||l.error||d.statusText||"unknown error";throw Error(`Paymaster error from ${o}: ${u}`)}let ex=new Set,eO=e=>`${e.chain.id}:${e.address}`,eP=e=>{ex.add(eO(e))},eD=e=>{ex.delete(eO(e))},eC=e=>ex.has(eO(e));async function eI(e){let t=e.timeoutMs||12e4,a=e.intervalMs||1e3,r=Date.now()+t;for(;Date.now()<r;){let t=await J(e);if(t)return t;await new Promise(e=>setTimeout(e,a))}throw Error("Timeout waiting for userOp to be mined")}async function eT(e){let{transaction:t,accountContract:a,factoryContract:r,adminAddress:n,overrides:i,sponsorGas:s,waitForDeployment:o=!0}=e,c=t.chain,d=t.client,l={client:d,chain:c,bundlerUrl:i?.bundlerUrl,entrypointAddress:i?.entrypointAddress},u=(0,z.bI)(e.overrides?.entrypointAddress||z.Ex),[p,m,y,f,v]=await Promise.all([(0,eh.isContractDeployed)(a),(0,ev.encode)(t),(0,eg.q)(t.gas),eV({executeTx:t,bundlerOptions:l,chain:c,client:d}),eN({accountContract:a,chain:c,client:d,entrypointAddress:i?.entrypointAddress,getNonceOverride:i?.getAccountNonce})]),{maxFeePerGas:h,maxPriorityFeePerGas:w}=f;return"v0.7"===u?eU({bundlerOptions:l,factoryContract:r,accountContract:a,adminAddress:n,sponsorGas:s,overrides:i,isDeployed:p,nonce:v,callData:m,callGasLimit:y,maxFeePerGas:h,maxPriorityFeePerGas:w,waitForDeployment:o}):eE({bundlerOptions:l,factoryContract:r,accountContract:a,adminAddress:n,sponsorGas:s,overrides:i,isDeployed:p,nonce:v,callData:m,callGasLimit:y,maxFeePerGas:h,maxPriorityFeePerGas:w,waitForDeployment:o})}async function eV(e){let{executeTx:t,bundlerOptions:a,chain:r,client:n}=e,{maxFeePerGas:i,maxPriorityFeePerGas:s}=t,o=a?.bundlerUrl??(0,z.Rg)(r);if((0,S.Rm)(o)){let e=await X({options:a});i=e.maxFeePerGas,s=e.maxPriorityFeePerGas}else{let[e,t]=await Promise.all([(0,eg.q)(i),(0,eg.q)(s)]);if(e&&t)i=e,s=t;else{let a=await (0,ef.E)(n,r);s=t??a.maxPriorityFeePerGas??0n,i=e??a.maxFeePerGas??0n}}return{maxFeePerGas:i,maxPriorityFeePerGas:s}}async function eU(e){let t,a;let{bundlerOptions:r,isDeployed:n,factoryContract:i,accountContract:s,adminAddress:o,sponsorGas:c,overrides:d,nonce:l,callData:u,callGasLimit:p,maxFeePerGas:m,maxPriorityFeePerGas:y,waitForDeployment:f}=e,{chain:v,client:h}=r;n||eC(s)?(a="0x",f&&await ek(s)):(t=i.address,a=await (0,ev.encode)(er({factoryContract:i,adminAddress:o,accountSalt:d?.accountSalt,createAccountOverride:d?.createAccount})),eP(s));let w={sender:s.address,nonce:l,callData:u,maxFeePerGas:m,maxPriorityFeePerGas:y,callGasLimit:p??0n,verificationGasLimit:0n,preVerificationGas:0n,factory:t,factoryData:a,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:z.Ld};if(c){let e=await eL({userOp:w,chain:v,client:h,entrypointAddress:d?.entrypointAddress,paymasterOverride:d?.paymaster});if(e.paymaster&&e.paymasterData&&(w.paymaster=e.paymaster,w.paymasterData=e.paymasterData),e.callGasLimit&&e.verificationGasLimit&&e.preVerificationGas&&e.paymasterPostOpGasLimit&&e.paymasterVerificationGasLimit)w.callGasLimit=e.callGasLimit,w.verificationGasLimit=e.verificationGasLimit,w.preVerificationGas=e.preVerificationGas,w.paymasterPostOpGasLimit=e.paymasterPostOpGasLimit,w.paymasterVerificationGasLimit=e.paymasterVerificationGasLimit;else{let t=await K({userOp:w,options:r});w.callGasLimit=t.callGasLimit,w.verificationGasLimit=t.verificationGasLimit,w.preVerificationGas=t.preVerificationGas,w.paymasterPostOpGasLimit=e.paymasterPostOpGasLimit||0n,w.paymasterVerificationGasLimit=e.paymasterVerificationGasLimit||0n;let a=await eL({userOp:w,chain:v,client:h,entrypointAddress:d?.entrypointAddress,paymasterOverride:d?.paymaster});a.paymaster&&a.paymasterData&&(w.paymaster=a.paymaster,w.paymasterData=a.paymasterData)}}else{let e=await K({userOp:w,options:r});w.callGasLimit=e.callGasLimit,w.verificationGasLimit=e.verificationGasLimit,w.preVerificationGas=e.preVerificationGas,w.paymasterPostOpGasLimit=e.paymasterPostOpGasLimit||0n,w.paymasterVerificationGasLimit=e.paymasterVerificationGasLimit||0n}return{...w,signature:"0x"}}async function eE(e){let t;let{bundlerOptions:a,isDeployed:r,factoryContract:n,accountContract:i,adminAddress:s,sponsorGas:o,overrides:c,nonce:d,callData:l,callGasLimit:u,maxFeePerGas:p,maxPriorityFeePerGas:m,waitForDeployment:y}=e,{chain:f,client:v}=a;r||eC(i)?(t="0x",y&&await ek(i)):(t=await e$({factoryContract:n,adminAddress:s,accountSalt:c?.accountSalt,createAccountOverride:c?.createAccount}),eP(i));let h={sender:i.address,nonce:d,initCode:t,callData:l,maxFeePerGas:p,maxPriorityFeePerGas:m,callGasLimit:u??0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:z.Ld};if(o){let e=await eL({userOp:h,chain:f,client:v,entrypointAddress:c?.entrypointAddress,paymasterOverride:c?.paymaster}),t="paymasterAndData"in e?e.paymasterAndData:"0x";if(t&&"0x"!==t&&(h.paymasterAndData=t),e.callGasLimit&&e.verificationGasLimit&&e.preVerificationGas)h.callGasLimit=e.callGasLimit,h.verificationGasLimit=e.verificationGasLimit,h.preVerificationGas=e.preVerificationGas;else{let e=await K({userOp:h,options:a});if(h.callGasLimit=e.callGasLimit,h.verificationGasLimit=e.verificationGasLimit,h.preVerificationGas=e.preVerificationGas,t&&"0x"!==t){let e=await eL({userOp:h,chain:f,client:v,entrypointAddress:c?.entrypointAddress,paymasterOverride:c?.paymaster}),t="paymasterAndData"in e?e.paymasterAndData:"0x";t&&"0x"!==t&&(h.paymasterAndData=t)}}}else{let e=await K({userOp:h,options:a});h.callGasLimit=e.callGasLimit,h.verificationGasLimit=e.verificationGasLimit,h.preVerificationGas=e.preVerificationGas}return{...h,signature:"0x"}}async function eM(e){let t;let{userOp:a,chain:r,entrypointAddress:n,adminAccount:i}=e;if("v0.7"===(0,z.bI)(n||z.Ex)){let i=eA(a);t=await ey({contract:(0,s.u)({address:n||z.JK,chain:r,client:e.client}),userOp:i})}else t=await eu({contract:(0,s.u)({address:n||z.Ex,chain:r,client:e.client}),userOp:a});if(i.signMessage){let e=await i.signMessage({message:{raw:(0,ew.nr)(t)}});return{...a,signature:e}}throw Error("signMessage not implemented in signingAccount")}async function e$(e){let{factoryContract:t,adminAddress:a,accountSalt:r,createAccountOverride:n}=e,i=er({factoryContract:t,adminAddress:a,accountSalt:r,createAccountOverride:n});return(0,ei.zo)([t.address,await (0,ev.encode)(i)])}async function eN(e){let{accountContract:t,chain:a,client:r,entrypointAddress:n,getNonceOverride:i}=e;return i?i(t):ec({contract:(0,s.u)({address:n||z.Ex,chain:a,client:r}),key:R(),sender:t.address})}async function ek(e){let t=Date.now();for(;eC(e);){if(Date.now()-t>6e4)throw eD(e),Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(e=>setTimeout(e,500))}}function eB(e){return"smart"===e.id}let e_=new WeakMap,eH=new WeakMap;async function eS(e,t,a){let{personalAccount:r,client:n,chain:o}=t;if(!r)throw Error("Personal wallet does not have an account");let c=o??a.chain;if(a.factoryAddress&&!a.overrides?.entrypointAddress){let e=await eK(a.factoryAddress,n,c);e&&(a.overrides={...a.overrides,entrypointAddress:e})}let d=a.factoryAddress??(0,z.yc)(a.overrides?.entrypointAddress),l="gasless"in a?a.gasless:a.sponsorGas;if(await (0,f.T)(c))return[function(e){let{creationOptions:t,connectionOptions:a,chain:r}=e,n={address:a.personalAccount.address,async sendTransaction(s){let o={data:s.data,to:s.to??void 0,value:s.value??0n,chain:(0,i.XY)(s.chainId),client:a.client,eip712:s.eip712},c=await (0,m.z)({account:n,transaction:o});if(e.sponsorGas&&!c.paymaster){let e=await Y({options:{client:a.client,chain:r,bundlerUrl:t.overrides?.bundlerUrl,entrypointAddress:t.overrides?.entrypointAddress},transaction:c});c={...c,...e}}let d=await (0,m.P)({account:n,chainId:r.id,eip712Transaction:c});return{transactionHash:(await Z({options:{client:a.client,chain:r,bundlerUrl:t.overrides?.bundlerUrl,entrypointAddress:t.overrides?.entrypointAddress},transaction:c,signedTransaction:d})).transactionHash,client:a.client,chain:r}},signMessage:async({message:e})=>a.personalAccount.signMessage({message:e}),async signTypedData(e){let t=(0,h.t)(e);return a.personalAccount.signTypedData(t)},onTransactionRequested:async e=>a.personalAccount.onTransactionRequested?.(e)};return n}({creationOptions:a,connectionOptions:t,chain:c,sponsorGas:l}),c];let u=(0,s.u)({client:n,address:d,chain:c}),p=await ea({factoryContract:u,adminAddress:r.address,predictAddressOverride:a.overrides?.predictAddress,accountSalt:a.overrides?.accountSalt,accountAddress:a.overrides?.accountAddress}).then(e=>e).catch(e=>{throw Error(`Failed to get account address with factory contract ${u.address} on chain ID ${c.id}: ${e?.message||"unknown error"}`,{cause:e})}),y=(0,s.u)({client:n,address:p,chain:c}),v=await ez({...a,chain:c,sponsorGas:l,personalAccount:r,accountContract:y,factoryContract:u,client:n});return e_.set(r,e),eH.set(e,r),[v,c]}async function ej(e){let t=eH.get(e);t&&(e_.delete(t),eH.delete(e))}async function ez(e){let{accountContract:t}=e,n={address:(0,y.Kn)(t.address),async sendTransaction(a){let r;let n=e.overrides?.erc20Paymaster;if(n){await eF({accountContract:t,erc20Paymaster:n,options:e});let a=async()=>({paymasterAndData:(0,v.concatHex)([n.address,n?.token]),paymaster:n.address,paymasterData:"0x"});r=e.overrides?.paymaster||a}else r=e.overrides?.paymaster;return eq({executeTx:en({accountContract:t,transaction:a,executeOverride:e.overrides?.execute}),options:{...e,overrides:{...e.overrides,paymaster:r}}})},sendBatchTransaction:async a=>eq({executeTx:function(e){let{accountContract:t,transactions:a,executeBatchOverride:r}=e;return r?r(t,a):(0,et.A)({contract:t,method:"function executeBatch(address[], uint256[], bytes[])",params:[a.map(e=>e.to||""),a.map(e=>e.value||0n),a.map(e=>e.data||"0x")]})}({accountContract:t,transactions:a,executeBatchOverride:e.overrides?.executeBatch}),options:e}),async signMessage({message:r}){let i;let[{isContractDeployed:s},{readContract:o},{encodeAbiParameters:c},{hashMessage:d},{checkContractWalletSignature:l}]=await Promise.all([Promise.resolve().then(a.bind(a,60689)),Promise.resolve().then(a.bind(a,26182)),Promise.resolve().then(a.bind(a,36877)),a.e(31445).then(a.bind(a,31445)),a.e(46675).then(a.bind(a,46675))]);await s(t)||(await eR({options:e,account:n,accountContract:t}),await eW({accountContract:t}));let u=d(r),p=!1;try{await o({contract:t,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[u]}),p=!0}catch{}if(p){let a=c([{type:"bytes32"}],[u]);i=await e.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:e.chain.id,verifyingContract:t.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:a}})}else i=await e.personalAccount.signMessage({message:r});if(await l({contract:t,message:r,signature:i}))return i;throw Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(i){let s;let o=(0,h.t)(i),[{isContractDeployed:c},{readContract:d},{encodeAbiParameters:l},{checkContractWalletSignedTypedData:u}]=await Promise.all([Promise.resolve().then(a.bind(a,60689)),Promise.resolve().then(a.bind(a,26182)),Promise.resolve().then(a.bind(a,36877)),a.e(50228).then(a.bind(a,50228))]);if(o.domain?.verifyingContract?.toLowerCase()===t.address?.toLowerCase())return e.personalAccount.signTypedData(o);await c(t)||(await eR({options:e,account:n,accountContract:t}),await eW({accountContract:t}));let p=(0,r.Jv)(o),m=!1;try{await d({contract:t,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[p]}),m=!0}catch{}if(m){let a=l([{type:"bytes32"}],[p]);s=await e.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:e.chain.id,verifyingContract:t.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:a}})}else s=await e.personalAccount.signTypedData(o);if(await u({contract:t,data:o,signature:s}))return s;throw Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},onTransactionRequested:async t=>e.personalAccount.onTransactionRequested?.(t)};return n}async function eF(e){let{accountContract:t,erc20Paymaster:a,options:r}=e,i=a.token,o=(0,s.u)({address:i,chain:t.chain,client:t.client});if(await l({contract:o,owner:t.address,spender:a.address})>0n)return;let c=(0,u.d)({contract:o,spender:a.address,amountWei:n.$H-1n}),d=await (0,p.n)({transaction:c,from:t.address}),m=en({accountContract:t,transaction:d,executeOverride:r.overrides?.execute});await eq({executeTx:m,options:{...r,overrides:{...r.overrides,erc20Paymaster:void 0}}})}async function eR(e){let{options:t,account:r,accountContract:n}=e,[{sendTransaction:i},{prepareTransaction:s}]=await Promise.all([Promise.resolve().then(a.bind(a,7509)),Promise.resolve().then(a.bind(a,71316))]),o=s({client:t.client,chain:t.chain,to:n.address,value:0n,gas:50000n});return await i({transaction:o,account:r})}async function eq(e){let{executeTx:t,options:a}=e,r=await eT({transaction:t,factoryContract:a.factoryContract,accountContract:a.accountContract,adminAddress:a.personalAccount.address,sponsorGas:a.sponsorGas,overrides:a.overrides}),n=await eM({client:a.client,chain:a.chain,adminAccount:a.personalAccount,entrypointAddress:a.overrides?.entrypointAddress,userOp:r}),i={chain:a.chain,client:a.client,bundlerUrl:a.overrides?.bundlerUrl,entrypointAddress:a.overrides?.entrypointAddress},s=await W({options:i,userOp:n}),o=await eI({...i,userOpHash:s});return eD(a.accountContract),{client:a.client,chain:a.chain,transactionHash:o.transactionHash}}async function eW(e){let{accountContract:t}=e,r=Date.now(),{isContractDeployed:n}=await Promise.resolve().then(a.bind(a,60689)),i=await n(t);for(;!i;){if(Date.now()-r>6e4)throw Error("Timeout: Smart account deployment not confirmed after 1 minute");await new Promise(e=>setTimeout(e,500)),i=await n(t)}}async function eK(e,t,a){let r=(0,s.u)({address:e,client:t,chain:a});try{return await (0,o.readContract)({contract:r,method:"function entrypoint() public view returns (address)"})}catch{return}}},85946:function(e,t,a){a.d(t,{Jv:function(){return c}});var r=a(45444),n=a(57040),i=a(92106),s=a(91734),o=a(2705);function c(e){let{domain:t={},message:a,primaryType:r}=e,i={EIP712Domain:(0,o.cj)({domain:t}),...e.types};(0,o.iC)({domain:t,message:a,primaryType:r,types:i});let c=["0x1901"];return t&&c.push(function({domain:e,types:t}){return d({data:e,primaryType:"EIP712Domain",types:t})}({domain:t,types:i})),"EIP712Domain"!==r&&c.push(d({data:a,primaryType:r,types:i})),(0,s.w)((0,n.zo)(c))}function d({data:e,primaryType:t,types:a}){let n=function e({data:t,primaryType:a,types:n}){let o=[{type:"bytes32"}],c=[function({primaryType:e,types:t}){let a=(0,i.NC)(function({primaryType:e,types:t}){let a="",r=function e({primaryType:t,types:a},r=new Set){let n=t.match(/^\w*/u),i=n?.[0];if(r.has(i)||void 0===a[i])return r;for(let t of(r.add(i),a[i]))e({primaryType:t.type,types:a},r);return r}({primaryType:e,types:t});for(let n of(r.delete(e),[e,...Array.from(r).sort()]))a+=`${n}(${t[n].map(({name:e,type:t})=>`${t} ${e}`).join(",")})`;return a}({primaryType:e,types:t}));return(0,s.w)(a)}({primaryType:a,types:n})];for(let d of n[a]){let[a,l]=function t({types:a,name:n,type:o,value:c}){if(void 0!==a[o])return[{type:"bytes32"},(0,s.w)(e({data:c,primaryType:o,types:a}))];if("bytes"===o){let e=c.length%2?"0":"";return c=`0x${e+c.slice(2)}`,[{type:"bytes32"},(0,s.w)(c)]}if("string"===o)return[{type:"bytes32"},(0,s.w)((0,i.NC)(c))];if(o.lastIndexOf("]")===o.length-1){let e=o.slice(0,o.lastIndexOf("[")),i=c.map(r=>t({name:n,type:e,types:a,value:r}));return[{type:"bytes32"},(0,s.w)((0,r.E)(i.map(([e])=>e),i.map(([,e])=>e)))]}return[{type:o},c]}({types:n,name:d.name,type:d.type,value:t[d.name]});o.push(a),c.push(l)}return(0,r.E)(o,c)}({data:e,primaryType:t,types:a});return(0,s.w)(n)}}}]);